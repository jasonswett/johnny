#!/usr/bin/env ruby

require File.expand_path('../../config/environment', __FILE__)

case ARGV[0]
when "index"
  book_collection = BookCollection.new
  book_collection.index!
when "tokens"
  Token.most_frequent_first.limit(30).each do |token|
    puts "#{token.value} (#{token.annotations['frequency']})"
  end
when "token"
  token = Token.find_by(value: ARGV[1])

  if token.present?
    puts token.details
  else
    puts "No such token. Sorry bro"
  end
when "pos"
  part_of_speech = ARGV[1]
  Token.part_of_speech(part_of_speech).limit(30).each do |token|
    puts "#{token.value} (#{token.annotations['frequency']})"
  end
when "analyze"
  words = ARGV[1..-1]

  tokens = words.map { |word| Token.find_by(value: word) || Token.new }
  parts_of_speech = tokens.map { |token| token.annotations["part_of_speech"] || "?" }
  puts parts_of_speech.join(" ")
else
  puts "Invalid input"
end
